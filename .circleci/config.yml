version: 2
jobs:
  macbuild:
    macos:
      xcode: "9.0"

    steps:
    - add_ssh_keys:
        fingerprints:
          - "3e:e5:ba:f2:fe:cf:0c:3a:86:c4:8e:ed:47:92:46:05"
      - checkout
      - run: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
      - run: brew install go

      - run:
          name: Install GuPM
          command: curl -fsSL  https://azukaar.github.io/GuPM/install.sh | sudo bash

      - run:
          name: Make
          command: g make

      - run:
          name: Build
          command: g publish mac
      
      - run: git config user.email "nobody@circleci.com"
      - run: git config user.name "Circle Ci"
      - run: git add docs
      - run: git commit -m "[skip-ci] Mac Release"
      - run: git push origin master

  linuxbuild:
    docker:
      - image: golang:1.12.5-stretch

    steps:
      - checkout

      - run:
          name: Install GuPM
          command: curl -fsSL  https://azukaar.github.io/GuPM/install.sh | bash

      - run:
          name: Make
          command: g make

      - run:
          name: Build
          command: g publish
      
      - run: git config user.email "nobody@circleci.com"
      - run: git config user.name "Circle Ci"
      - run: git add docs
      - run: git commit -m "[skip-ci] Linux Release"
      - run: git push origin master

workflows:
  version: 2
  build-all:
    jobs:
      - macbuild:
          filters:
            branches:
              only:
                - master
      - linuxbuild:
          filters:
            branches:
              only:
                - master